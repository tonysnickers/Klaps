<% if params["user"].nil? %>

  <br><br>
  <h1 class="text-center">My friends' favorites</h1>

  <% @friends_list.each do |f| %>

      <div class="dahboard-card-content ">
        <div class="d-flex justify-content-between mb-2">
          <% user = User.where(id: f)  %>
        </div>
        <% faves = [] %>
          <% Favorite.where(user_id: user[0].id).map do |favorite| %>
            <% faves << favorite.movie %>
          <% end %>
        <% if faves.empty? %>
        <% else %>
        <div class="see-f-fav"><div><%= user[0].username %>'s favorites </div><%= link_to friendsfav_favorite_path(user: user[0].id) do %>
            <p>See all <i class="fa-solid fa-arrow-right-long"></i></p>
          <% end %>
        </div>

          <% if faves.count == 1 %>
            <div id="carouselNoTouching" class="carousel slide" data-bs-touch="true" data-bs-interval="false">
              <div class="carousel-inner">
                <div class="carousel-item active">
                  <img src="<%= faves[0].poster %>" class="ms-3" style="height: 45%" width="45%">
                </div>
              </div>
            </div>
          <% elsif faves.count == 2 %>
            <div id="carouselNoTouching" class="carousel slide" data-bs-touch="true" data-bs-interval="false">
              <div class="carousel-inner">
                <div class="carousel-item active">
                  <img src="<%= faves[0].poster %>" class="ms-3" style="height: 45%" width="45%">
                  <img src="<%= faves[1].poster %>" style="height: 45%" width="45%">
                </div>
            </div>
          <% elsif faves.count == 3 %>
            <div id="carouselNoTouching" class="carousel slide" data-bs-touch="true" data-bs-interval="false">
              <div class="carousel-inner">
                <div class="carousel-item active">
                  <img src="<%= faves[0].poster %>" class="ms-3" style="height: 45%" width="45%">
                  <img src="<%= faves[1].poster %>" style="height: 45%" width="45%">
                </div>
                <div class="carousel-item">
                  <img src="<%= faves[2].poster %>" class="ms-3" style="height: 45%" width="45%">
                </div>
              <button class="carousel-control-prev" type="button" data-bs-target="#carouselNoTouching" data-bs-slide="prev">
                <%# <span class="carousel-control-prev-icon" aria-hidden="true"></span> %>
                <span class="visually-hidden">Previous</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#carouselNoTouching" data-bs-slide="next">
                <%# <span class="carousel-control-next-icon" aria-hidden="false"></span> %>
                <span class="visually-hidden">Next</span>
              </button>
            </div>
          <% elsif faves.count == 4 %>
            <div id="carouselNoTouching" class="carousel slide" data-bs-touch="true" data-bs-interval="false">
              <div class="carousel-inner">
                <div class="carousel-item active">
                  <img src="<%= faves[0].poster %>" class="ms-3" style="height: 45%" width="45%">
                  <img src="<%= faves[1].poster %>" style="height: 45%" width="45%">
                </div>
                <div class="carousel-item">
                  <img src="<%= faves[2].poster %>" class="ms-3" style="height: 45%" width="45%">
                  <img src="<%= faves[3].poster %>" style="height: 45%" width="45%">
                </div>
              </div>
              <button class="carousel-control-prev" type="button" data-bs-target="#carouselNoTouching" data-bs-slide="prev">
                <%# <span class="carousel-control-prev-icon" aria-hidden="true"></span> %>
                <span class="visually-hidden">Previous</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#carouselNoTouching" data-bs-slide="next">
                <%# <span class="carousel-control-next-icon" aria-hidden="false"></span> %>
                <span class="visually-hidden">Next</span>
              </button>
            </div>
          <% elsif faves.count == 5 %>
            <div id="carouselNoTouching" class="carousel slide" data-bs-touch="true" data-bs-interval="false">
              <div class="carousel-inner">
                <div class="carousel-item active">
                  <img src="<%= faves[0].poster %>" class="ms-3" style="height: 45%" width="45%">
                  <img src="<%= faves[1].poster %>" style="height: 45%" width="45%">
                </div>
                <div class="carousel-item">
                  <img src="<%= faves[2].poster %>" class="ms-3" style="height: 45%" width="45%">
                  <img src="<%= faves[3].poster %>" style="height: 45%" width="45%">
                </div>
                <div class="carousel-item">
                  <img src="<%= faves[4].poster %>" class="ms-3" style="height: 45%" width="45%">
                </div>
              </div>
              <button class="carousel-control-prev" type="button" data-bs-target="#carouselNoTouching" data-bs-slide="prev">
                <%# <span class="carousel-control-prev-icon" aria-hidden="true"></span> %>
                <span class="visually-hidden">Previous</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#carouselNoTouching" data-bs-slide="next">
                <%# <span class="carousel-control-next-icon" aria-hidden="false"></span> %>
                <span class="visually-hidden">Next</span>
              </button>
            </div>
          <% else %>
            <div id="carouselNoTouching" class="carousel slide" data-bs-touch="true" data-bs-interval="false">
              <div class="carousel-inner">
                <div class="carousel-item active">
                  <img src="<%= faves[0].poster %>" class="ms-3" style="height: 45%" width="45%">
                  <img src="<%= faves[1].poster %>" style="height: 45%" width="45%">
                </div>
                <div class="carousel-item">
                  <img src="<%= faves[2].poster %>" class="ms-3" style="height: 45%" width="45%">
                  <img src="<%= faves[3].poster %>" style="height: 45%" width="45%">
                </div>
                <div class="carousel-item">
                  <img src="<%= faves[4].poster %>" class="ms-3" style="height: 45%" width="45%">
                  <img src="<%= faves[5].poster %>" style="height: 45%" width="45%">
                </div>
              </div>
              <button class="carousel-control-prev" type="button" data-bs-target="#carouselNoTouching" data-bs-slide="prev">
                <%# <span class="carousel-control-prev-icon" aria-hidden="true"></span> %>
                <span class="visually-hidden">Previous</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#carouselNoTouching" data-bs-slide="next">
                <%# <span class="carousel-control-next-icon" aria-hidden="false"></span> %>
                <span class="visually-hidden">Next</span>
              </button>
            </div>
            <% end %>
          <% end %>
      </div>

  <% end %>

<% else %>

  <h5><%= User.where(id: params["user"]).first.username %>'s favorites</h5>

  <% favorites = [] %>
  <% Favorite.where(user_id: params["user"]).map { |f| favorites << f.movie_id } %>

  <div class="movie-container">
    <% favorites.each do |id| %>
      <button type="button" class="card-movie background" id = "dragitem"
              data-drag-target="card" data-movie-id="<%= Movie.where(id: id)[0].id %>"
              data-bs-toggle="modal" data-bs-target="#filmsModal<%=Movie.where(id: id)[0].id%>" >
        <img src="<%= Movie.where(id: id)[0].poster %>" width="10%" />
        <div class="card-movie-infos">
          <h2 class="text-start overflow-visible"><%= Movie.where(id: id)[0].name %></h2>
          <p class="text-start genres-infos">
            <%= Movie.where(id: id)[0].genre[0...4].to_s.gsub(/[\[\]\"]/,"") %>
          </p>
          <p class="text-start other-infos"><%= Movie.where(id: id)[0].year %>  ~  <%= Movie.where(id: id)[0].duration %> min  ~  <%= Movie.where(id: id)[0].rating %>/10 <i class="fa-solid fa-star"></i></p>
        </div>
      </button>
    <% end %>
  </div>

  <div>
    <%# Modals %>
    <% favorites.each do |id| %>
      <div class="modal fade" id="filmsModal<%=Movie.where(id: id)[0].id%>" tabindex="-1" aria-labelledby="filmsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
          <div class="modal-content bg-dark">

            <div class="modal-body">
              <img src= "<%= Movie.where(id: id)[0].poster %>" class="final-poster" object-fit="cover" style="border-radius: 10px"/>
              <div class="card-movie-infos">
                <h2 class="mt-4"><strong><%= Movie.where(id: id)[0].name %></strong></h2>
                <div>
                  <p class="text-start"><%= Movie.where(id: id)[0].genre.to_s.gsub(/[\[\]\"]/,"") %></p>
                  <p><%= Movie.where(id: id)[0].year %> - <%= Movie.where(id: id)[0].duration %> min</p>
                </div>

                <hr>

                <div>
                  <p class="fw-semibold text-decoration-underline fs-6 wish-show-small-titles">Casting</p>
                  <p><%= Movie.where(id: id)[0].actor.first(3).to_s.gsub(/[\[\]\"]/,"") %></p>
                </div>

                <hr>

                <div>
                  <p class="fw-semibold text-decoration-underline fs-6 wish-show-small-titles">Synopsis</p>
                  <p class="synopsis"><%= Movie.where(id: id)[0].synopsis %></p>
                </div>

                <hr>
                <div>
                <% if Movie.where(id: id)[0].platform? == true %>
                    <p class="fw-semibold text-decoration-underline fs-6 wish-show-small-titles">Available on</p>
                    <p><%= Movie.where(id: id)[0].platform.to_s.gsub(/[\[\]\"]/,"") %></p>
                  <% else %>
                    <small>This movie is not free on any platform</small>
                  <% end %>
                </div>
              </div>
            </div>

            <div class="modal-footer">
              <div class="d-flex justify-content-between w-100">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </div>

          </div>
        </div>
      </div>
    <% end%>
    <br><br><br>
  </div>

<% end %>
